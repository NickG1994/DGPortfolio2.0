import React, { useMemo, useState } from "react";
import styles from "../styles/gridGallery.module.css";
import { projects } from "../data/projects_data";
import Image from "next/image";
import Modal from "./Modal";
import { m, LazyMotion, domAnimation } from "framer-motion";
import { SyncLoader } from "react-spinners";
import { useEffect } from "react";
//import framer anmimation object
import { animateSlideDown } from "../data/framer-motion config";

function GridGallery() {
  const [modalIndex, setModalIndex] = useState(0);
  const [state, setState] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  // classname is generated by next.js. So i had to copy from the inspector
  // and paste the real or generated classname into the code directly.
  function toggleModal(e) {
    e.preventDefault();
    setModalIndex(e.currentTarget.id);
    setState((prevToggle) => !prevToggle);
  }

  return (
    <LazyMotion features={domAnimation}>
      <div className={styles.galleryGrid}>
        {projects.map((project, index) => (
          <m.div
            className={styles.front}
            style={{ position: "relative" }}
            key={index}
          >
            <m.div
              className={isLoading ? styles.loadingContainer : ""}
              initial={{ opacity: 0 }}
              animate={{ opacity: 1, background: "#ECB365", zIndex: 100 }}
              exit={{ opacity: 0, backgroundColor: "transparent" }}
              transition={2}
            >
              <SyncLoader
                color="#064663"
                style={isLoading ? { display: "block" } : { display: "none" }}
              />
            </m.div>
            <m.div
              id={`image-${index}`}
              variants={animateSlideDown}
              initial={animateSlideDown.initial}
              viewport={{
                once: true,
              }}
              whileInView={animateSlideDown.animate}
              transition={{
                ...animateSlideDown.transition,
                delay: 0.15 * index,
              }}
              onClick={(e) => {
                toggleModal(e);
              }}
              className={styles.gridItem}
            >
              <Image
                loading="lazy"
                className={styles.galleryImg}
                src={project.src}
                onLoad={() => {
                  setIsLoading((prevLoading) => (prevLoading = false));
                }}
              />

              <div className={styles.overlay}>
                <div id={index} className={styles.overlayContainer}>
                  <p className={styles.overlayText}>{project.Header}</p>
                </div>
              </div>
            </m.div>
          </m.div>
        ))}
      </div>
      <div
        onClick={(e) => {
          toggleModal(e);
        }}
      >
        {state && <Modal id={modalIndex} />}
      </div>
    </LazyMotion>
  );
}

export default GridGallery;
